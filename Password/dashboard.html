<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #121212;
      color: #fff;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 2rem;
      background-color: #1e1e1e;
    }

    .top-bar .actions {
      display: flex;
      gap: 1rem;
    }

    .action-btn {
      padding: 0.5rem 1rem;
      border: none;
      background-color: #6c5ce7;
      color: white;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .action-btn:hover {
      background-color: #a29bfe;
    }

    .main-buttons {
      display: flex;
      justify-content: center;
      gap: 2rem;
      margin-top: 4rem;
    }

    .popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: #2c2c2c;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(108, 92, 231, 0.5);
      display: none;
      z-index: 999;
    }

    .popup input {
      display: block;
      margin-bottom: 1rem;
      width: 100%;
      padding: 0.5rem;
      border-radius: 6px;
      border: none;
    }

    .popup-buttons {
      display: flex;
      justify-content: space-between;
    }

    #accounts-container {
      margin: 2rem;
    }

    .account-card {
      background-color: #1f1f1f;
      padding: 1rem;
      margin-bottom: 1rem;
      border-left: 4px solid #6c5ce7;
    }
    .accounts-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
  background-color: #111;
  color: #fff;
}

.accounts-table th, .accounts-table td {
  border: 1px solid #555;
  padding: 10px;
  text-align: center;
}

.accounts-table th {
  background-color: #333;
}

.delete-btn, .edit-btn {
  padding: 6px 10px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-weight: bold;
}

.delete-btn {
  background-color: crimson;
  color: white;
}

.edit-btn {
  background-color: #007bff;
  color: white;
}

  </style>
</head>
<body>
  <div class="top-bar">
    <div class="logo">Password Manager</div>
    <div class="actions">
      <button class="action-btn" onclick="fetchAllAccounts()">Fetch All Accounts</button>

      <button class="action-btn" onclick="showAddPopup()">Add Account [+]</button>
      
      <button class="action-btn" onclick="logout()">Logout</button>
    </div>
  </div>

  <div class="main-buttons">
    <button class="action-btn" onclick="fetchAllAccounts()">Fetch All Accounts</button>
    <br>
      <button class="action-btn" onclick="showAddPopup()">Add Account [+]</button>
       <br>
    <button class="action-btn" onclick="showFetchOnePopup()">Fetch One Account</button>
    <br>
  </div>

  <div id="accounts-container"></div>

  <div class="popup" id="addAccountPopup">
    <h3>Add Account</h3>
    <input type="text" id="website" placeholder="Website Name">
    <input type="text" id="username" placeholder="Username">
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <div class="popup-buttons">
      <button class="action-btn" onclick="addAccount()">Add</button>
      <button class="action-btn" onclick="closeAddPopup()">Cancel</button>
    </div>
  </div>

  <div class="popup" id="fetchOnePopup">
    <h3>Fetch One Account</h3>
    <input type="text" id="fetchWebsite" placeholder="Website Name">
    <div class="popup-buttons">
      <button class="action-btn" onclick="fetchOneAccount()">Fetch</button>
      <button class="action-btn" onclick="closeFetchOnePopup()">Cancel</button>
    </div>
  </div>

  <script>
    const email = localStorage.getItem("emailOrUserName");

    function logout() {
      localStorage.clear();
      window.location.href = "login.html";
    }

    function showAddPopup() {
      document.getElementById("addAccountPopup").style.display = "block";
    }

    function closeAddPopup() {
      document.getElementById("addAccountPopup").style.display = "none";
    }

    function showFetchOnePopup() {
      document.getElementById("fetchOnePopup").style.display = "block";
    }

    function closeFetchOnePopup() {
      document.getElementById("fetchOnePopup").style.display = "none";
    }
function fetchAllAccounts() {
  fetch(`http://localhost:8080/accounts?email=${email}`)
    .then(response => response.json())
    .then(data => {
      const container = document.getElementById("accounts-container");
      container.innerHTML = ""; // Clear previous content

      // Create table and header
      const table = document.createElement("table");
      table.className = "accounts-table";
      table.innerHTML = `
        <thead>
          <tr>
            <th>Website</th>
            <th>Username</th>
            <th>Email</th>
            <th>Password</th>
            <th>Delete</th>
            <th>Edit</th>
          </tr>
        </thead>
        <tbody></tbody>
      `;

      const tbody = table.querySelector("tbody");

      data.forEach(account => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${account.websiteName}</td>
          <td>${account.userName}</td>
          <td>${account.email}</td>
          <td>${account.password}</td>
          <td><button class="delete-btn" data-id="${account.id}">Delete</button></td>
          <td><button class="edit-btn" data-id="${account.id}">Edit</button></td>
          console.log("${account.id}")
        `;
        tbody.appendChild(row);
      });


      container.appendChild(table);

      // Attach delete and edit handlers
      document.querySelectorAll(".delete-btn").forEach(button => {
        button.addEventListener("click", () => {
          const id = button.getAttribute("data-id");
          deleteAccount(id);
        });
      });
      function deleteAccount(id) {
  fetch(`http://localhost:8080/account/${id}`, {
    method: "DELETE"
  })
    .then(response => {
      if (response.ok) {
        alert("Account deleted successfully.");
        fetchAllAccounts(); // refresh table
      } else {
        alert("Failed to delete account.");
      }
    })
    .catch(error => console.error("Error deleting account:", error));
}

      document.querySelectorAll(".edit-btn").forEach(button => {
        button.addEventListener("click", () => {
          const id = button.getAttribute("data-id");
          editAccount(id);
        });
      });
    })
    .catch(error => console.error("Error fetching accounts:", error));
}

    function addAccount() {
  const website = document.getElementById("website").value.trim();
  const username = document.getElementById("username").value.trim();
  const accountEmail = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value.trim();

  if (!website || !username || !accountEmail || !password) {
    alert("All fields are required!");
    return;
  }

  const account = {
    websiteName: website,
    userName: username,
    email: accountEmail,
    password: password,
    rootUserEmail: email
  };

  fetch("http://localhost:8080/addAccount", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify(account)
  })
  .then(response => {
    if (!response.ok) throw new Error("Failed to add account.");
    return response.json();
  })
  .then(() => {
    closeAddPopup();
    alert("Account added successfully");
    document.getElementById("website").value = "";
    document.getElementById("username").value = "";
    document.getElementById("email").value = "";
    document.getElementById("password").value = "";
  })
  .catch(error => {
    console.error("Error adding account:", error);
    alert("Error adding account. Try again later.");
  });
}

function fetchOneAccount() {
  const website = document.getElementById("fetchWebsite").value.trim();
  if (!website) {
    alert("Please enter a website name.");
    return;
  }

  fetch(`http://localhost:8080/accounts/${website}?email=${email}`)
    .then(response => {
      if (!response.ok) throw new Error("Failed to fetch account.");
      return response.json();
    })
    .then(data => {
      const container = document.getElementById("accounts-container");
      container.innerHTML = "";
      if (data.length === 0) {
        container.innerHTML = "<p>No accounts found for the provided website.</p>";
      } else {
        data.forEach(account => {
          const card = document.createElement("div");
          card.className = "account-card";
          card.innerHTML = `
            <strong>Website:</strong> ${account.websiteName}<br>
            <strong>Username:</strong> ${account.userName}<br>
            <strong>Email:</strong> ${account.email}<br>
            <strong>Password:</strong> ${account.password}
          `;
          container.appendChild(card);
        });
      }
      closeFetchOnePopup();
      document.getElementById("fetchWebsite").value = "";
    })
    .catch(error => {
      console.error("Error fetching account:", error);
      alert("Error fetching account. Try again later.");
    });
}


   
      
  </script>
</body>
</html>
